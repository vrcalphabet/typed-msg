<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>typed-msg API Documentation - v3.2.0</title><meta name="description" content="Documentation for typed-msg API Documentation"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">typed-msg API Documentation - v3.2.0</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>typed-msg API Documentation - v3.2.0</h1></div><div class="tsd-panel tsd-typography"><h1 id="typed-msg" class="tsd-anchor-link">typed-msg<a href="#typed-msg" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<p><a href="https://badge.fury.io/js/typed-msg"><img src="https://badge.fury.io/js/typed-msg.svg" alt="npm version"></a>
<a href="https://www.typescriptlang.org/"><img src="https://img.shields.io/badge/TypeScript-Ready-blue.svg" alt="TypeScript"></a>
<a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></p>
<p>TypeScriptで書かれた、Chrome拡張機能のSW⇔Content Scripts間の通信を型安全にするラッパーライブラリです。</p>
<p>サンプルプロジェクトは <a href="https://github.com/vrcalphabet/typed-msg-example">こちら</a> にあります。</p>
<h2 id="例" class="tsd-anchor-link">例<a href="#例" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>この例では、ストレージ操作とタブ操作の2つのスコープを持つメッセージインタフェイスを定義します。</p>
<h3 id="1-メッセージインターフェース（型）定義" class="tsd-anchor-link">1. メッセージインターフェース（型）定義<a href="#1-メッセージインターフェース（型）定義" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li>スコープごとに送受信するメッセージの型を定義します。
<ul>
<li>各メッセージは <code>req</code>（リクエスト）と <code>res</code>（レスポンス）のプロパティを持ちます。</li>
<li><code>req</code> はリクエストのパラメータ型です。パラメータが不要な場合は省略できます。</li>
<li><code>res</code> にはデータの型を直接指定します。レスポンスが不要な場合は <code>void</code> を指定します。</li>
</ul>
</li>
<li><code>MergeMessageDefinitions&lt;T&gt;</code> を使ってスコープごとのメッセージ型を統合します。</li>
<li><code>createMessaging&lt;T&gt;()</code> で型付きの <code>sender</code> (メッセージ送信用関数) と <code>receive</code> (メッセージ受信用関数) を取得し、エクスポートします。</li>
</ul>
<pre><code class="ts"><span class="hl-0">// types/messages.ts</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-1">type</span><span class="hl-2"> </span><span class="hl-3">MergeMessageDefinitions</span><span class="hl-2">, </span><span class="hl-3">createMessaging</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&#39;typed-msg&#39;</span><br/><br/><span class="hl-5">interface</span><span class="hl-2"> </span><span class="hl-6">StorageSettings</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">theme</span><span class="hl-2">: </span><span class="hl-4">&#39;light&#39;</span><span class="hl-2"> | </span><span class="hl-4">&#39;dark&#39;</span><br/><span class="hl-2">  </span><span class="hl-3">language</span><span class="hl-2">: </span><span class="hl-6">string</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-5">interface</span><span class="hl-2"> </span><span class="hl-6">TabInfo</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-3">id</span><span class="hl-2">: </span><span class="hl-6">number</span><br/><span class="hl-2">  </span><span class="hl-3">url</span><span class="hl-2">: </span><span class="hl-6">string</span><br/><span class="hl-2">  </span><span class="hl-3">title</span><span class="hl-2">: </span><span class="hl-6">string</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// ストレージ関連のメッセージ</span><br/><span class="hl-5">type</span><span class="hl-2"> </span><span class="hl-6">StorageMessages</span><span class="hl-2"> = {</span><br/><span class="hl-2">  </span><span class="hl-0">// 設定を保存</span><br/><span class="hl-2">  </span><span class="hl-3">setSettings</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-3">req</span><span class="hl-2">: </span><span class="hl-6">StorageSettings</span><br/><span class="hl-2">    </span><span class="hl-3">res</span><span class="hl-2">: </span><span class="hl-6">void</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-0">// 設定を取得</span><br/><span class="hl-2">  </span><span class="hl-3">getSettings</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-3">res</span><span class="hl-2">: </span><span class="hl-6">StorageSettings</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// タブ関連のメッセージ</span><br/><span class="hl-5">type</span><span class="hl-2"> </span><span class="hl-6">TabMessages</span><span class="hl-2"> = {</span><br/><span class="hl-2">  </span><span class="hl-0">// 現在のタブ情報を取得</span><br/><span class="hl-2">  </span><span class="hl-3">getCurrentTab</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-3">res</span><span class="hl-2">: </span><span class="hl-6">TabInfo</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-0">// 新しいタブを開く</span><br/><span class="hl-2">  </span><span class="hl-3">openTab</span><span class="hl-2">: {</span><br/><span class="hl-2">    </span><span class="hl-3">req</span><span class="hl-2">: { </span><span class="hl-3">url</span><span class="hl-2">: </span><span class="hl-6">string</span><span class="hl-2"> }</span><br/><span class="hl-2">    </span><span class="hl-3">res</span><span class="hl-2">: { </span><span class="hl-3">tabId</span><span class="hl-2">: </span><span class="hl-6">number</span><span class="hl-2"> }</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// すべてのスコープを統合</span><br/><span class="hl-5">type</span><span class="hl-2"> </span><span class="hl-6">Messages</span><span class="hl-2"> = </span><span class="hl-6">MergeMessageDefinitions</span><span class="hl-2">&lt;{</span><br/><span class="hl-2">  </span><span class="hl-3">storage</span><span class="hl-2">: </span><span class="hl-6">StorageMessages</span><br/><span class="hl-2">  </span><span class="hl-3">tabs</span><span class="hl-2">: </span><span class="hl-6">TabMessages</span><br/><span class="hl-2">}&gt;</span><br/><br/><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">sender</span><span class="hl-2">, </span><span class="hl-7">receive</span><span class="hl-2"> } = </span><span class="hl-8">createMessaging</span><span class="hl-2">&lt;</span><span class="hl-6">Messages</span><span class="hl-2">&gt;()</span>
</code><button type="button">Copy</button></pre>

<h3 id="2-受信側（service-worker）" class="tsd-anchor-link">2. 受信側（Service Worker）<a href="#2-受信側（service-worker）" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li><code>receive(scope)</code> でスコープを指定して <code>Receiver</code> インスタンスを取得します。</li>
<li><code>Receiver.on(name, handler)</code> でメッセージの名前に対応したハンドラーを登録します。
<ul>
<li><code>success(data)</code> や <code>failure(message)</code> で成功または失敗レスポンスを返します。</li>
</ul>
</li>
<li>ハンドラーは、スコープごとにファイルを分けても動作します。</li>
</ul>
<pre><code class="ts"><span class="hl-0">// background.ts</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">receive</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&#39;./types/messages&#39;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">success</span><span class="hl-2">, </span><span class="hl-3">failure</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&#39;typed-msg&#39;</span><br/><br/><span class="hl-0">// ストレージ関連のハンドラー</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">storageReceiver</span><span class="hl-2"> = </span><span class="hl-8">receive</span><span class="hl-2">(</span><span class="hl-4">&#39;storage&#39;</span><span class="hl-2">)</span><br/><br/><span class="hl-3">storageReceiver</span><span class="hl-2">.</span><span class="hl-8">on</span><span class="hl-2">(</span><span class="hl-4">&#39;setSettings&#39;</span><span class="hl-2">, </span><span class="hl-5">async</span><span class="hl-2"> (</span><span class="hl-3">req</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-3">chrome</span><span class="hl-2">.</span><span class="hl-3">storage</span><span class="hl-2">.</span><span class="hl-3">local</span><span class="hl-2">.</span><span class="hl-8">set</span><span class="hl-2">({ </span><span class="hl-3">settings:</span><span class="hl-2"> </span><span class="hl-3">req</span><span class="hl-2"> })</span><br/><span class="hl-2">  </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-8">success</span><span class="hl-2">()</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-3">storageReceiver</span><span class="hl-2">.</span><span class="hl-8">on</span><span class="hl-2">(</span><span class="hl-4">&#39;getSettings&#39;</span><span class="hl-2">, </span><span class="hl-5">async</span><span class="hl-2"> () </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">data</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-3">chrome</span><span class="hl-2">.</span><span class="hl-3">storage</span><span class="hl-2">.</span><span class="hl-3">local</span><span class="hl-2">.</span><span class="hl-8">get</span><span class="hl-2">&lt;</span><span class="hl-6">any</span><span class="hl-2">&gt;(</span><span class="hl-4">&#39;settings&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-8">success</span><span class="hl-2">(</span><span class="hl-3">data</span><span class="hl-2">.</span><span class="hl-3">settings</span><span class="hl-2">)</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">// タブ関連のハンドラー</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">tabsReceiver</span><span class="hl-2"> = </span><span class="hl-8">receive</span><span class="hl-2">(</span><span class="hl-4">&#39;tabs&#39;</span><span class="hl-2">)</span><br/><br/><span class="hl-3">tabsReceiver</span><span class="hl-2">.</span><span class="hl-8">on</span><span class="hl-2">(</span><span class="hl-4">&#39;getCurrentTab&#39;</span><span class="hl-2">, </span><span class="hl-5">async</span><span class="hl-2"> (</span><span class="hl-3">_</span><span class="hl-2">, </span><span class="hl-3">sender</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">tab</span><span class="hl-2"> = </span><span class="hl-3">sender</span><span class="hl-2">.</span><span class="hl-3">tab</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!(</span><span class="hl-3">tab</span><span class="hl-2"> &amp;&amp; </span><span class="hl-3">tab</span><span class="hl-2">.</span><span class="hl-3">id</span><span class="hl-2"> &amp;&amp; </span><span class="hl-3">tab</span><span class="hl-2">.</span><span class="hl-3">url</span><span class="hl-2"> &amp;&amp; </span><span class="hl-3">tab</span><span class="hl-2">.</span><span class="hl-3">title</span><span class="hl-2">)) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-8">failure</span><span class="hl-2">(</span><span class="hl-4">&#39;タブ情報を取得できませんでした&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-8">success</span><span class="hl-2">({ </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-3">tab</span><span class="hl-2">.</span><span class="hl-3">id</span><span class="hl-2">, </span><span class="hl-3">url:</span><span class="hl-2"> </span><span class="hl-3">tab</span><span class="hl-2">.</span><span class="hl-3">url</span><span class="hl-2">, </span><span class="hl-3">title:</span><span class="hl-2"> </span><span class="hl-3">tab</span><span class="hl-2">.</span><span class="hl-3">title</span><span class="hl-2"> })</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-3">tabsReceiver</span><span class="hl-2">.</span><span class="hl-8">on</span><span class="hl-2">(</span><span class="hl-4">&#39;openTab&#39;</span><span class="hl-2">, </span><span class="hl-5">async</span><span class="hl-2"> (</span><span class="hl-3">req</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">tab</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-3">chrome</span><span class="hl-2">.</span><span class="hl-3">tabs</span><span class="hl-2">.</span><span class="hl-8">create</span><span class="hl-2">({ </span><span class="hl-3">url:</span><span class="hl-2"> </span><span class="hl-3">req</span><span class="hl-2">.</span><span class="hl-3">url</span><span class="hl-2"> })</span><br/><span class="hl-2">  </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-3">tab</span><span class="hl-2">.</span><span class="hl-3">id</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-8">failure</span><span class="hl-2">(</span><span class="hl-4">&#39;タブを開けませんでした&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-8">success</span><span class="hl-2">({ </span><span class="hl-3">tabId:</span><span class="hl-2"> </span><span class="hl-3">tab</span><span class="hl-2">.</span><span class="hl-3">id</span><span class="hl-2"> })</span><br/><span class="hl-2">})</span>
</code><button type="button">Copy</button></pre>

<h3 id="3-送信側（content-scripts）" class="tsd-anchor-link">3. 送信側（Content Scripts）<a href="#3-送信側（content-scripts）" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li><code>sender(scope)</code> でスコープを指定し、送信インターフェースを取得します。</li>
<li>メッセージを送信すると、<code>Promise</code> でレスポンスを受け取ります。
<ul>
<li><code>req</code> が不要なメッセージは引数なしで呼び出せます。</li>
</ul>
</li>
<li><code>instanceof Success</code> または <code>instanceof Failure</code> でレスポンスの成功/失敗を判定します。
<ul>
<li>成功時: プロパティに直接アクセスできます。</li>
<li>失敗時: <code>message</code> プロパティでエラーメッセージにアクセスできます。</li>
</ul>
</li>
</ul>
<pre><code class="ts"><span class="hl-0">// content.ts</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">sender</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&#39;./types/messages&#39;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">Success</span><span class="hl-2">, </span><span class="hl-3">Failure</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&#39;typed-msg&#39;</span><br/><br/><span class="hl-0">// スコープごとに送信インターフェースを作成</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">storage</span><span class="hl-2"> = </span><span class="hl-8">sender</span><span class="hl-2">(</span><span class="hl-4">&#39;storage&#39;</span><span class="hl-2">)</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">tabs</span><span class="hl-2"> = </span><span class="hl-8">sender</span><span class="hl-2">(</span><span class="hl-4">&#39;tabs&#39;</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// 設定を保存</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">saveResult</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-3">storage</span><span class="hl-2">.</span><span class="hl-8">setSettings</span><span class="hl-2">({ </span><span class="hl-3">theme:</span><span class="hl-2"> </span><span class="hl-4">&#39;dark&#39;</span><span class="hl-2">, </span><span class="hl-3">language:</span><span class="hl-2"> </span><span class="hl-4">&#39;ja&#39;</span><span class="hl-2"> })</span><br/><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">saveResult</span><span class="hl-2"> </span><span class="hl-5">instanceof</span><span class="hl-2"> </span><span class="hl-6">Success</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">log</span><span class="hl-2">(</span><span class="hl-4">&#39;設定を保存しました&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// 設定を取得</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">settingsResult</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-3">storage</span><span class="hl-2">.</span><span class="hl-8">getSettings</span><span class="hl-2">()</span><br/><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">settingsResult</span><span class="hl-2"> </span><span class="hl-5">instanceof</span><span class="hl-2"> </span><span class="hl-6">Success</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">log</span><span class="hl-2">(</span><span class="hl-4">&#39;テーマ:&#39;</span><span class="hl-2">, </span><span class="hl-3">settingsResult</span><span class="hl-2">.</span><span class="hl-3">theme</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">log</span><span class="hl-2">(</span><span class="hl-4">&#39;言語:&#39;</span><span class="hl-2">, </span><span class="hl-3">settingsResult</span><span class="hl-2">.</span><span class="hl-3">language</span><span class="hl-2">)</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">// 現在のタブ情報を取得</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">tabResult</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-3">tabs</span><span class="hl-2">.</span><span class="hl-8">getCurrentTab</span><span class="hl-2">()</span><br/><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">tabResult</span><span class="hl-2"> </span><span class="hl-5">instanceof</span><span class="hl-2"> </span><span class="hl-6">Failure</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">error</span><span class="hl-2">(</span><span class="hl-4">&#39;取得に失敗しました&#39;</span><span class="hl-2">, </span><span class="hl-3">tabResult</span><span class="hl-2">.</span><span class="hl-3">message</span><span class="hl-2">)</span><br/><span class="hl-2">  </span><span class="hl-1">return</span><br/><span class="hl-2">}</span><br/><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">log</span><span class="hl-2">(</span><span class="hl-4">&#39;タブID:&#39;</span><span class="hl-2">, </span><span class="hl-3">tabResult</span><span class="hl-2">.</span><span class="hl-3">id</span><span class="hl-2">)</span><br/><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">log</span><span class="hl-2">(</span><span class="hl-4">&#39;URL:&#39;</span><span class="hl-2">, </span><span class="hl-3">tabResult</span><span class="hl-2">.</span><span class="hl-3">url</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// 新しいタブを開く</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-7">openResult</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-3">tabs</span><span class="hl-2">.</span><span class="hl-8">openTab</span><span class="hl-2">({ </span><span class="hl-3">url:</span><span class="hl-2"> </span><span class="hl-4">&#39;https://example.com&#39;</span><span class="hl-2"> })</span><br/><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">openResult</span><span class="hl-2"> </span><span class="hl-5">instanceof</span><span class="hl-2"> </span><span class="hl-6">Success</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">log</span><span class="hl-2">(</span><span class="hl-4">&#39;新しいタブを開きました:&#39;</span><span class="hl-2">, </span><span class="hl-3">openResult</span><span class="hl-2">.</span><span class="hl-3">tabId</span><span class="hl-2">)</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="4-オプション（）" class="tsd-anchor-link">4. オプション（<code>MessagingOptions</code>）<a href="#4-オプション（）" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p><code>createMessaging&lt;T&gt;()</code> の第1引数にオプションオブジェクトを渡すことで、通信エラーのハンドリングやリクエスト/レスポンスのフック処理を設定できます。</p>
<p>すべてのオプションは省略可能です。</p>
<table>
<thead>
<tr>
<th>オプション</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>onError</code></td>
<td>通信レベルのエラー（SW 停止など）が発生したときに呼ばれるコールバック。<code>failure()</code> によるビジネスロジックの失敗では呼ばれません。</td>
</tr>
<tr>
<td><code>onRequest</code></td>
<td>メッセージ受信時、メインハンドラーが実行される<strong>前に</strong>呼ばれるフック。ロギングやデバッグ用途を想定しています。</td>
</tr>
<tr>
<td><code>onResponse</code></td>
<td>メインハンドラーが実行され、レスポンスを返した<strong>後に</strong>呼ばれるフック。</td>
</tr>
</tbody>
</table>
<h4 id="_" class="tsd-anchor-link"><code>onError</code><a href="#_" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4>
<p>通信レベルのエラーが発生したときのコールバックです。 Content Scripts 側で発火します。</p>
<ul>
<li><code>Failure</code> を返すと、Promise がその <code>Failure</code> で <code>resolve</code> します。</li>
<li>何も返さない場合は、従来通り <code>MessagingError</code> がスローされます。</li>
</ul>
<pre><code class="ts"><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-1">type</span><span class="hl-2"> </span><span class="hl-3">MergeMessageDefinitions</span><span class="hl-2">, </span><span class="hl-3">createMessaging</span><span class="hl-2">, </span><span class="hl-3">failure</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&#39;typed-msg&#39;</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">sender</span><span class="hl-2">, </span><span class="hl-7">receive</span><span class="hl-2"> } = </span><span class="hl-8">createMessaging</span><span class="hl-2">&lt;</span><span class="hl-6">Messages</span><span class="hl-2">&gt;({</span><br/><span class="hl-2">  </span><span class="hl-8">onError</span><span class="hl-3">:</span><span class="hl-2"> (</span><span class="hl-3">error</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-0">// error は MessagingError インスタンス</span><br/><span class="hl-2">    </span><span class="hl-0">// error.scope, error.name, error.message が利用可能</span><br/><span class="hl-2">    </span><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">error</span><span class="hl-2">(</span><span class="hl-4">`[</span><span class="hl-5">${</span><span class="hl-3">error</span><span class="hl-9">.</span><span class="hl-3">scope</span><span class="hl-5">}</span><span class="hl-4">.</span><span class="hl-5">${</span><span class="hl-3">error</span><span class="hl-9">.</span><span class="hl-3">name</span><span class="hl-5">}</span><span class="hl-4">] </span><span class="hl-5">${</span><span class="hl-3">error</span><span class="hl-9">.</span><span class="hl-3">message</span><span class="hl-5">}</span><span class="hl-4">`</span><span class="hl-2">)</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// Failure を返すと reject せずに resolve される</span><br/><span class="hl-2">    </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-8">failure</span><span class="hl-2">(</span><span class="hl-4">&#39;通信に失敗しました&#39;</span><span class="hl-2">)</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">})</span>
</code><button type="button">Copy</button></pre>

<h4 id="_-1" class="tsd-anchor-link"><code>onRequest</code><a href="#_-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4>
<p>メッセージ受信時、ハンドラー実行前に呼ばれるフックです。 Service Worker 側で発火します。</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">sender</span><span class="hl-2">, </span><span class="hl-7">receive</span><span class="hl-2"> } = </span><span class="hl-8">createMessaging</span><span class="hl-2">&lt;</span><span class="hl-6">Messages</span><span class="hl-2">&gt;({</span><br/><span class="hl-2">  </span><span class="hl-8">onRequest</span><span class="hl-3">:</span><span class="hl-2"> ({ </span><span class="hl-3">scope</span><span class="hl-2">, </span><span class="hl-3">name</span><span class="hl-2">, </span><span class="hl-3">req</span><span class="hl-2"> }) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">log</span><span class="hl-2">(</span><span class="hl-4">`[</span><span class="hl-5">${</span><span class="hl-3">scope</span><span class="hl-5">}</span><span class="hl-4">] </span><span class="hl-5">${</span><span class="hl-3">name</span><span class="hl-5">}</span><span class="hl-4"> を受信しました`</span><span class="hl-2">, { </span><span class="hl-3">req</span><span class="hl-2"> })</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">})</span>
</code><button type="button">Copy</button></pre>

<h4 id="_-2" class="tsd-anchor-link"><code>onResponse</code><a href="#_-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4>
<p>ハンドラー実行後、レスポンス返却時に呼ばれるフックです。 Service Worker 側で発火します。</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> { </span><span class="hl-7">sender</span><span class="hl-2">, </span><span class="hl-7">receive</span><span class="hl-2"> } = </span><span class="hl-8">createMessaging</span><span class="hl-2">&lt;</span><span class="hl-6">Messages</span><span class="hl-2">&gt;({</span><br/><span class="hl-2">  </span><span class="hl-8">onResponse</span><span class="hl-3">:</span><span class="hl-2"> ({ </span><span class="hl-3">scope</span><span class="hl-2">, </span><span class="hl-3">name</span><span class="hl-2">, </span><span class="hl-3">req</span><span class="hl-2">, </span><span class="hl-3">res</span><span class="hl-2"> }) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-8">log</span><span class="hl-2">(</span><span class="hl-4">`[</span><span class="hl-5">${</span><span class="hl-3">scope</span><span class="hl-5">}</span><span class="hl-4">] </span><span class="hl-5">${</span><span class="hl-3">name</span><span class="hl-5">}</span><span class="hl-4"> が完了しました`</span><span class="hl-2">, { </span><span class="hl-3">req</span><span class="hl-2">, </span><span class="hl-3">res</span><span class="hl-2"> })</span><br/><span class="hl-2">  },</span><br/><span class="hl-2">})</span>
</code><button type="button">Copy</button></pre>

<h2 id="インストール" class="tsd-anchor-link">インストール<a href="#インストール" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<pre><code class="bash"><span class="hl-8">npm</span><span class="hl-2"> </span><span class="hl-4">install</span><span class="hl-2"> </span><span class="hl-4">typed-msg</span><br/><span class="hl-0"># or</span><br/><span class="hl-8">yarn</span><span class="hl-2"> </span><span class="hl-4">add</span><span class="hl-2"> </span><span class="hl-4">typed-msg</span><br/><span class="hl-0"># or</span><br/><span class="hl-8">pnpm</span><span class="hl-2"> </span><span class="hl-4">add</span><span class="hl-2"> </span><span class="hl-4">typed-msg</span>
</code><button type="button">Copy</button></pre>

<h2 id="貢献" class="tsd-anchor-link">貢献<a href="#貢献" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>プロジェクトへの貢献を歓迎します！以下のルールに従うと，あなたの貢献がスムーズになります！</p>
<h3 id="issue-pr" class="tsd-anchor-link">Issue / PR<a href="#issue-pr" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Issueを立てる際は，バグ報告・機能要望のどちらかを明記してください。
PRの説明には，目的・変更点・影響範囲・サンプルコードがあるとありがたいです。</p>
<h2 id="ライセンス" class="tsd-anchor-link">ライセンス<a href="#ライセンス" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>MIT License</p>
<p>詳細は<a href="media/LICENSE">LICENSE</a>ファイルを参照してください。</p>
<h2 id="変更履歴・リリース情報" class="tsd-anchor-link">変更履歴・リリース情報<a href="#変更履歴・リリース情報" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<h3 id="v100-2026-02-08" class="tsd-anchor-link">v1.0.0 (2026-02-08)<a href="#v100-2026-02-08" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li>初回リリース</li>
</ul>
<h3 id="v200-2026-02-08" class="tsd-anchor-link">v2.0.0 (2026-02-08)<a href="#v200-2026-02-08" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li>成功時のメッセージレスポンス <code>SuccessMessageResponse</code> のプロパティを <code>message</code> から <code>data</code> に変更</li>
<li>失敗時のメッセージレスポンス <code>FailureMessageResponse</code> の <code>message</code> 型を変更/省略</li>
<li>ハンドラー未定義時のエラーをより分かりやすく</li>
<li>ユーティリティ関数 <code>success</code>, <code>failure</code> を追加</li>
</ul>
<h3 id="v201-2026-02-10" class="tsd-anchor-link">v2.0.1 (2026-02-10)<a href="#v201-2026-02-10" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li><code>failure</code> 関数の戻り値のプロパティを <code>data</code> から <code>message</code> に修正</li>
</ul>
<h3 id="v210-2026-02-13" class="tsd-anchor-link">v2.1.0 (2026-02-13)<a href="#v210-2026-02-13" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li><code>onAny</code> メソッドを追加</li>
</ul>
<h3 id="v300-2026-02-23" class="tsd-anchor-link">v3.0.0 (2026-02-23)<a href="#v300-2026-02-23" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<ul>
<li><code>connect</code> を <code>sender</code> に名前変更</li>
<li>レスポンスの判定方法を <code>result.success</code> から <code>instanceof Success</code> / <code>instanceof Failure</code> に変更</li>
<li>成功レスポンスのデータに直接アクセス可能に</li>
<li><code>Success</code> / <code>Failure</code> クラスを追加</li>
<li><code>MessagingOptions</code> を追加</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#typed-msg"><span>typed-<wbr/>msg</span></a><ul><li><a href="#例"><span>例</span></a></li><li><ul><li><a href="#1-メッセージインターフェース（型）定義"><span>1. メッセージインターフェース（型）定義</span></a></li><li><a href="#2-受信側（service-worker）"><span>2. 受信側（<wbr/>Service <wbr/>Worker）</span></a></li><li><a href="#3-送信側（content-scripts）"><span>3. 送信側（<wbr/>Content <wbr/>Scripts）</span></a></li><li><a href="#4-オプション（）"><span>4. オプション（）</span></a></li><li><ul><li><a href="#_"><span></span></a></li><li><a href="#_-1"><span></span></a></li><li><a href="#_-2"><span></span></a></li></ul></li></ul></li><li><a href="#インストール"><span>インストール</span></a></li><li><a href="#貢献"><span>貢献</span></a></li><li><ul><li><a href="#issue-pr"><span>Issue / <wbr/>PR</span></a></li></ul></li><li><a href="#ライセンス"><span>ライセンス</span></a></li><li><a href="#変更履歴・リリース情報"><span>変更履歴・リリース情報</span></a></li><li><ul><li><a href="#v100-2026-02-08"><span>v1.0.0 (2026-<wbr/>02-<wbr/>08)</span></a></li><li><a href="#v200-2026-02-08"><span>v2.0.0 (2026-<wbr/>02-<wbr/>08)</span></a></li><li><a href="#v201-2026-02-10"><span>v2.0.1 (2026-<wbr/>02-<wbr/>10)</span></a></li><li><a href="#v210-2026-02-13"><span>v2.1.0 (2026-<wbr/>02-<wbr/>13)</span></a></li><li><a href="#v300-2026-02-23"><span>v3.0.0 (2026-<wbr/>02-<wbr/>23)</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">typed-msg API Documentation - v3.2.0</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
